!function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="./build",e(0)}([function(t,e,i){t.exports=function(t){"use strict";var e,s,o,n,r,h,a,p,c,d=!1,u=y,y={},l=new t.Vector3,x=new t.Vector3,_=new t.Matrix4,f=new t.Quaternion,b={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3},m=14,g=5,j=9,w=6;return s=function(){this._eventListeners={}},s.prototype.addEventListener=function(t,e){this._eventListeners.hasOwnProperty(t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e)},s.prototype.removeEventListener=function(t,e){var i;return!!this._eventListeners.hasOwnProperty(t)&&((i=this._eventListeners[t].indexOf(e))>=0&&(this._eventListeners[t].splice(i,1),!0))},s.prototype.dispatchEvent=function(t){var e,i=Array.prototype.splice.call(arguments,1);if(this._eventListeners.hasOwnProperty(t))for(e=0;e<this._eventListeners[t].length;e++)this._eventListeners[t][e].apply(this,i)},s.make=function(t){t.prototype.addEventListener=s.prototype.addEventListener,t.prototype.removeEventListener=s.prototype.removeEventListener,t.prototype.dispatchEvent=s.prototype.dispatchEvent},o=function(){var t=1;return function(){return t++}}(),n=function(e,i,s,o){return new t.Vector3(Math.atan2(2*(e*o-i*s),o*o-e*e-i*i+s*s),Math.asin(2*(e*s+i*o)),Math.atan2(2*(s*o-e*i),o*o+e*e-i*i-s*s))},r=function(t,e,i){var s,o,n,r,h,a,p,c;return s=Math.cos(e),o=Math.sin(e),n=Math.cos(-i),r=Math.sin(-i),h=Math.cos(t),a=Math.sin(t),p=s*n,c=o*r,{w:p*h-c*a,x:p*a+c*h,y:o*n*h+s*r*a,z:s*r*h-o*n*a}},h=function(t,e){return _.identity(),_.identity().makeRotationFromQuaternion(e.quaternion),_.getInverse(_),l.copy(t),x.copy(e.position),l.sub(x).applyMatrix4(_)},y.noConflict=function(){return window.Physijs=u,y},y.createMaterial=function(t,e,i){var s=function(){};return s.prototype=t,s=new s,s._physijs={id:t.id,friction:void 0===e?.8:e,restitution:void 0===i?.2:i},s},y.PointConstraint=function(t,e,i){void 0===i&&(i=e,e=void 0),this.type="point",this.appliedImpulse=0,this.id=o(),this.objecta=t._physijs.id,this.positiona=h(i,t).clone(),e&&(this.objectb=e._physijs.id,this.positionb=h(i,e).clone())},y.PointConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb}},y.HingeConstraint=function(t,e,i,s){void 0===s&&(s=i,i=e,e=void 0),this.type="hinge",this.appliedImpulse=0,this.id=o(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=h(i,t).clone(),this.position=i.clone(),this.axis=s,e&&(this.objectb=e._physijs.id,this.positionb=h(i,e).clone())},y.HingeConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},y.HingeConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("hinge_setLimits",{constraint:this.id,low:t,high:e,bias_factor:i,relaxation_factor:s})},y.HingeConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("hinge_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},y.HingeConstraint.prototype.disableMotor=function(t,e){this.scene.execute("hinge_disableMotor",{constraint:this.id})},y.SliderConstraint=function(t,e,i,s){void 0===s&&(s=i,i=e,e=void 0),this.type="slider",this.appliedImpulse=0,this.id=o(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=h(i,t).clone(),this.axis=s,e&&(this.objectb=e._physijs.id,this.positionb=h(i,e).clone())},y.SliderConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},y.SliderConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("slider_setLimits",{constraint:this.id,lin_lower:t,lin_upper:e,ang_lower:i,ang_upper:s})},y.SliderConstraint.prototype.setRestitution=function(t,e){this.scene.execute("slider_setRestitution",{constraint:this.id,linear:t,angular:e})},y.SliderConstraint.prototype.enableLinearMotor=function(t,e){this.scene.execute("slider_enableLinearMotor",{constraint:this.id,velocity:t,acceleration:e})},y.SliderConstraint.prototype.disableLinearMotor=function(){this.scene.execute("slider_disableLinearMotor",{constraint:this.id})},y.SliderConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("slider_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},y.SliderConstraint.prototype.disableAngularMotor=function(){this.scene.execute("slider_disableAngularMotor",{constraint:this.id})},y.ConeTwistConstraint=function(t,e,i){if(void 0===i)throw"Both objects must be defined in a ConeTwistConstraint.";this.type="conetwist",this.appliedImpulse=0,this.id=o(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=h(i,t).clone(),this.objectb=e._physijs.id,this.positionb=h(i,e).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z}},y.ConeTwistConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},y.ConeTwistConstraint.prototype.setLimit=function(t,e,i){this.scene.execute("conetwist_setLimit",{constraint:this.id,x:t,y:e,z:i})},y.ConeTwistConstraint.prototype.enableMotor=function(){this.scene.execute("conetwist_enableMotor",{constraint:this.id})},y.ConeTwistConstraint.prototype.setMaxMotorImpulse=function(t){this.scene.execute("conetwist_setMaxMotorImpulse",{constraint:this.id,max_impulse:t})},y.ConeTwistConstraint.prototype.setMotorTarget=function(e){e instanceof t.Vector3?e=(new t.Quaternion).setFromEuler(new t.Euler(e.x,e.y,e.z)):e instanceof t.Euler?e=(new t.Quaternion).setFromEuler(e):e instanceof t.Matrix4&&(e=(new t.Quaternion).setFromRotationMatrix(e)),this.scene.execute("conetwist_setMotorTarget",{constraint:this.id,x:e.x,y:e.y,z:e.z,w:e.w})},y.ConeTwistConstraint.prototype.disableMotor=function(){this.scene.execute("conetwist_disableMotor",{constraint:this.id})},y.DOFConstraint=function(t,e,i){void 0===i&&(i=e,e=void 0),this.type="dof",this.appliedImpulse=0,this.id=o(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=h(i,t).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},e&&(this.objectb=e._physijs.id,this.positionb=h(i,e).clone(),this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z})},y.DOFConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},y.DOFConstraint.prototype.setLinearLowerLimit=function(t){this.scene.execute("dof_setLinearLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},y.DOFConstraint.prototype.setLinearUpperLimit=function(t){this.scene.execute("dof_setLinearUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},y.DOFConstraint.prototype.setAngularLowerLimit=function(t){this.scene.execute("dof_setAngularLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},y.DOFConstraint.prototype.setAngularUpperLimit=function(t){this.scene.execute("dof_setAngularUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},y.DOFConstraint.prototype.enableAngularMotor=function(t){this.scene.execute("dof_enableAngularMotor",{constraint:this.id,which:t})},y.DOFConstraint.prototype.configureAngularMotor=function(t,e,i,s,o){this.scene.execute("dof_configureAngularMotor",{constraint:this.id,which:t,low_angle:e,high_angle:i,velocity:s,max_force:o})},y.DOFConstraint.prototype.disableAngularMotor=function(t){this.scene.execute("dof_disableAngularMotor",{constraint:this.id,which:t})},y.Scene=function(o){var n=this;s.call(this),t.Scene.call(this);var r=i(1);this._worker=new r,this._worker.transferableMessage=this._worker.webkitPostMessage||this._worker.postMessage,this._materials_ref_counts={},this._objects={},this._vehicles={},this._constraints={};var h=new ArrayBuffer(1);this._worker.transferableMessage(h,[h]),e=0===h.byteLength,this._worker.onmessage=function(t){var e,i=t.data;if(i instanceof ArrayBuffer&&1!==i.byteLength&&(i=new Float32Array(i)),i instanceof Float32Array)switch(i[0]){case b.WORLDREPORT:n._updateScene(i);break;case b.COLLISIONREPORT:n._updateCollisions(i);break;case b.VEHICLEREPORT:n._updateVehicles(i);break;case b.CONSTRAINTREPORT:n._updateConstraints(i)}else if(i.cmd)switch(i.cmd){case"objectReady":e=i.params,n._objects[e]&&n._objects[e].dispatchEvent("ready");break;case"worldReady":n.dispatchEvent("ready");break;case"vehicle":window.test=i;break;default:console.debug("Received: "+i.cmd),console.dir(i.params)}else switch(i[0]){case b.WORLDREPORT:n._updateScene(i);break;case b.COLLISIONREPORT:n._updateCollisions(i);break;case b.VEHICLEREPORT:n._updateVehicles(i);break;case b.CONSTRAINTREPORT:n._updateConstraints(i)}},o=o||{},o.fixedTimeStep=o.fixedTimeStep||1/60,o.rateLimit=o.rateLimit||!0,this.execute("init",o)},y.Scene.prototype=new t.Scene,y.Scene.prototype.constructor=y.Scene,s.make(y.Scene),y.Scene.prototype._updateScene=function(t){var i,s,o,n=t[1];for(s=0;s<n;s++)o=2+s*m,i=this._objects[t[o]],void 0!==i&&(i.__dirtyPosition===!1&&i.position.set(t[o+1],t[o+2],t[o+3]),i.__dirtyRotation===!1&&i.quaternion.set(t[o+4],t[o+5],t[o+6],t[o+7]),i._physijs.linearVelocity.set(t[o+8],t[o+9],t[o+10]),i._physijs.angularVelocity.set(t[o+11],t[o+12],t[o+13]));e&&this._worker.transferableMessage(t.buffer,[t.buffer]),d=!1,this.dispatchEvent("update")},y.Scene.prototype._updateVehicles=function(t){var i,s,o,n;for(o=0;o<(t.length-1)/j;o++)n=1+o*j,i=this._vehicles[t[n]],void 0!==i&&(s=i.wheels[t[n+1]],s.position.set(t[n+2],t[n+3],t[n+4]),s.quaternion.set(t[n+5],t[n+6],t[n+7],t[n+8]));e&&this._worker.transferableMessage(t.buffer,[t.buffer])},y.Scene.prototype._updateConstraints=function(t){var i,s,o,n;for(o=0;o<(t.length-1)/w;o++)n=1+o*w,i=this._constraints[t[n]],s=this._objects[t[n+1]],void 0!==i&&void 0!==s&&(l.set(t[n+2],t[n+3],t[n+4]),_.extractRotation(s.matrix),l.applyMatrix4(_),i.positiona.addVectors(s.position,l),i.appliedImpulse=t[n+5]);e&&this._worker.transferableMessage(t.buffer,[t.buffer])},y.Scene.prototype._updateCollisions=function(t){var i,s,o,n,r,h,a,d={},u={};for(i=0;i<t[1];i++)o=2+i*g,n=t[o],r=t[o+1],u[n+"-"+r]=o+2,u[r+"-"+n]=-1*(o+2),d[n]||(d[n]=[]),d[n].push(r),d[r]||(d[r]=[]),d[r].push(n);for(h in this._objects)if(this._objects.hasOwnProperty(h))if(n=this._objects[h],d[h]){for(s=0;s<n._physijs.touches.length;s++)d[h].indexOf(n._physijs.touches[s])===-1&&n._physijs.touches.splice(s--,1);for(s=0;s<d[h].length;s++)if(a=d[h][s],r=this._objects[a],r&&n._physijs.touches.indexOf(a)===-1){n._physijs.touches.push(a),l.subVectors(n.getLinearVelocity(),r.getLinearVelocity()),p=l.clone(),l.subVectors(n.getAngularVelocity(),r.getAngularVelocity()),c=l.clone();var y=u[n._physijs.id+"-"+r._physijs.id];y>0?l.set(-t[y],-t[y+1],-t[y+2]):(y*=-1,l.set(t[y],t[y+1],t[y+2])),n.dispatchEvent("collision",r,p,c,l)}}else n._physijs.touches.length=0;this.collisions=d,e&&this._worker.transferableMessage(t.buffer,[t.buffer])},y.Scene.prototype.addConstraint=function(e,i){if(this._constraints[e.id]=e,this.execute("addConstraint",e.getDefinition()),i){var s;switch(e.type){case"point":s=new t.Mesh(new t.SphereGeometry(1.5),new t.MeshNormalMaterial),s.position.copy(e.positiona),this._objects[e.objecta].add(s);break;case"hinge":s=new t.Mesh(new t.SphereGeometry(1.5),new t.MeshNormalMaterial),s.position.copy(e.positiona),this._objects[e.objecta].add(s);break;case"slider":s=new t.Mesh(new t.BoxGeometry(10,1,1),new t.MeshNormalMaterial),s.position.copy(e.positiona),s.rotation.set(e.axis.y,e.axis.x,e.axis.z),this._objects[e.objecta].add(s);break;case"conetwist":s=new t.Mesh(new t.SphereGeometry(1.5),new t.MeshNormalMaterial),s.position.copy(e.positiona),this._objects[e.objecta].add(s);break;case"dof":s=new t.Mesh(new t.SphereGeometry(1.5),new t.MeshNormalMaterial),s.position.copy(e.positiona),this._objects[e.objecta].add(s)}}return e},y.Scene.prototype.onSimulationResume=function(){this.execute("onSimulationResume",{})},y.Scene.prototype.removeConstraint=function(t){void 0!==this._constraints[t.id]&&(this.execute("removeConstraint",{id:t.id}),delete this._constraints[t.id])},y.Scene.prototype.execute=function(t,e){this._worker.postMessage({cmd:t,params:e})},a=function(t,e){var i;for(i=0;i<e.children.length;i++)e.children[i]._physijs&&(e.children[i].updateMatrix(),e.children[i].updateMatrixWorld(),l.setFromMatrixPosition(e.children[i].matrixWorld),f.setFromRotationMatrix(e.children[i].matrixWorld),e.children[i]._physijs.position_offset={x:l.x,y:l.y,z:l.z},e.children[i]._physijs.rotation={x:f.x,y:f.y,z:f.z,w:f.w},t._physijs.children.push(e.children[i]._physijs)),a(t,e.children[i])},y.Scene.prototype.add=function(e){if(t.Mesh.prototype.add.call(this,e),e._physijs)if(e.world=this,e instanceof y.Vehicle)this.add(e.mesh),this._vehicles[e._physijs.id]=e,this.execute("addVehicle",e._physijs);else{e.__dirtyPosition=!1,e.__dirtyRotation=!1,this._objects[e._physijs.id]=e,e.children.length&&(e._physijs.children=[],a(e,e)),e.material._physijs&&(this._materials_ref_counts.hasOwnProperty(e.material._physijs.id)?this._materials_ref_counts[e.material._physijs.id]++:(this.execute("registerMaterial",e.material._physijs),e._physijs.materialId=e.material._physijs.id,this._materials_ref_counts[e.material._physijs.id]=1)),e._physijs.position={x:e.position.x,y:e.position.y,z:e.position.z},e._physijs.rotation={x:e.quaternion.x,y:e.quaternion.y,z:e.quaternion.z,w:e.quaternion.w};new t.Vector3(1,1,1);e._physijs.width&&(e._physijs.width*=e.scale.x),e._physijs.height&&(e._physijs.height*=e.scale.y),e._physijs.depth&&(e._physijs.depth*=e.scale.z),this.execute("addObject",e._physijs)}},y.Scene.prototype.remove=function(e){if(e instanceof y.Vehicle){for(this.execute("removeVehicle",{id:e._physijs.id});e.wheels.length;)this.remove(e.wheels.pop());this.remove(e.mesh),delete this._vehicles[e._physijs.id]}else t.Mesh.prototype.remove.call(this,e),e._physijs&&(delete this._objects[e._physijs.id],this.execute("removeObject",{id:e._physijs.id}));e.material&&e.material._physijs&&this._materials_ref_counts.hasOwnProperty(e.material._physijs.id)&&(this._materials_ref_counts[e.material._physijs.id]--,0==this._materials_ref_counts[e.material._physijs.id]&&(this.execute("unRegisterMaterial",e.material._physijs),delete this._materials_ref_counts[e.material._physijs.id]))},y.Scene.prototype.setFixedTimeStep=function(t){t&&this.execute("setFixedTimeStep",t)},y.Scene.prototype.setGravity=function(t){t&&this.execute("setGravity",t)},y.Scene.prototype.simulate=function(t,e){var i,s,o;if(d)return!1;d=!0;for(i in this._objects)this._objects.hasOwnProperty(i)&&(s=this._objects[i],(s.__dirtyPosition||s.__dirtyRotation)&&(o={id:s._physijs.id},s.__dirtyPosition&&(o.pos={x:s.position.x,y:s.position.y,z:s.position.z},s.__dirtyPosition=!1),s.__dirtyRotation&&(o.quat={x:s.quaternion.x,y:s.quaternion.y,z:s.quaternion.z,w:s.quaternion.w},s.__dirtyRotation=!1),this.execute("updateTransform",o)));return this.execute("simulate",{timeStep:t,maxSubSteps:e}),!0},y.Mesh=function(e,i,n){e&&(s.call(this),t.Mesh.call(this,e,i),e.boundingBox||e.computeBoundingBox(),this._physijs={type:null,id:o(),mass:n||0,touches:[],linearVelocity:new t.Vector3,angularVelocity:new t.Vector3})},y.Mesh.prototype=new t.Mesh,y.Mesh.prototype.constructor=y.Mesh,s.make(y.Mesh),y.Mesh.prototype.__defineGetter__("mass",function(){return this._physijs.mass}),y.Mesh.prototype.__defineSetter__("mass",function(t){this._physijs.mass=t,this.world&&this.world.execute("updateMass",{id:this._physijs.id,mass:t})}),y.Mesh.prototype.applyCentralImpulse=function(t){this.world&&this.world.execute("applyCentralImpulse",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},y.Mesh.prototype.applyImpulse=function(t,e){this.world&&this.world.execute("applyImpulse",{id:this._physijs.id,impulse_x:t.x,impulse_y:t.y,impulse_z:t.z,x:e.x,y:e.y,z:e.z})},y.Mesh.prototype.applyTorque=function(t){this.world&&this.world.execute("applyTorque",{id:this._physijs.id,torque_x:t.x,torque_y:t.y,torque_z:t.z})},y.Mesh.prototype.applyCentralForce=function(t){this.world&&this.world.execute("applyCentralForce",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},y.Mesh.prototype.applyForce=function(t,e){this.world&&this.world.execute("applyForce",{id:this._physijs.id,force_x:t.x,force_y:t.y,force_z:t.z,x:e.x,y:e.y,z:e.z})},y.Mesh.prototype.getAngularVelocity=function(){return this._physijs.angularVelocity},y.Mesh.prototype.setAngularVelocity=function(t){this.world&&this.world.execute("setAngularVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},y.Mesh.prototype.getLinearVelocity=function(){return this._physijs.linearVelocity},y.Mesh.prototype.setLinearVelocity=function(t){this.world&&this.world.execute("setLinearVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},y.Mesh.prototype.setAngularFactor=function(t){this.world&&this.world.execute("setAngularFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},y.Mesh.prototype.setLinearFactor=function(t){this.world&&this.world.execute("setLinearFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},y.Mesh.prototype.setDamping=function(t,e){this.world&&this.world.execute("setDamping",{id:this._physijs.id,linear:t,angular:e})},y.Mesh.prototype.setCcdMotionThreshold=function(t){this.world&&this.world.execute("setCcdMotionThreshold",{id:this._physijs.id,threshold:t})},y.Mesh.prototype.setCcdSweptSphereRadius=function(t){this.world&&this.world.execute("setCcdSweptSphereRadius",{id:this._physijs.id,radius:t})},y.PlaneMesh=function(t,e,i){var s,o;y.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="plane",this._physijs.normal=t.faces[0].normal.clone(),this._physijs.mass="undefined"==typeof i?s*o:i},y.PlaneMesh.prototype=new y.Mesh,y.PlaneMesh.prototype.constructor=y.PlaneMesh,y.HeightfieldMesh=function(t,e,i,s,o){y.Mesh.call(this,t,e,i),this._physijs.type="heightfield",this._physijs.xsize=t.boundingBox.max.x-t.boundingBox.min.x,this._physijs.ysize=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.xpts="undefined"==typeof s?Math.sqrt(t.vertices.length):s+1,this._physijs.ypts="undefined"==typeof o?Math.sqrt(t.vertices.length):o+1,this._physijs.absMaxHeight=Math.max(t.boundingBox.max.z,Math.abs(t.boundingBox.min.z));for(var n,r,h=[],a=0;a<t.vertices.length;a++)n=a%this._physijs.xpts,r=Math.round(a/this._physijs.xpts-a%this._physijs.xpts/this._physijs.xpts),h[a]=t.vertices[n+(this._physijs.ypts-r-1)*this._physijs.ypts].z;this._physijs.points=h},y.HeightfieldMesh.prototype=new y.Mesh,y.HeightfieldMesh.prototype.constructor=y.HeightfieldMesh,y.BoxMesh=function(t,e,i){var s,o,n;y.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="box",this._physijs.width=s,this._physijs.height=o,this._physijs.depth=n,this._physijs.mass="undefined"==typeof i?s*o*n:i},y.BoxMesh.prototype=new y.Mesh,y.BoxMesh.prototype.constructor=y.BoxMesh,y.SphereMesh=function(t,e,i){y.Mesh.call(this,t,e,i),t.boundingSphere||t.computeBoundingSphere(),this._physijs.type="sphere",this._physijs.radius=t.boundingSphere.radius,this._physijs.mass="undefined"==typeof i?4/3*Math.PI*Math.pow(this._physijs.radius,3):i},y.SphereMesh.prototype=new y.Mesh,y.SphereMesh.prototype.constructor=y.SphereMesh,y.CylinderMesh=function(t,e,i){var s,o,n;y.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="cylinder",this._physijs.width=s,this._physijs.height=o,this._physijs.depth=n,this._physijs.mass="undefined"==typeof i?s*o*n:i},y.CylinderMesh.prototype=new y.Mesh,y.CylinderMesh.prototype.constructor=y.CylinderMesh,y.CapsuleMesh=function(t,e,i){var s,o,n;y.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,n=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="capsule",this._physijs.radius=Math.max(s/2,n/2),this._physijs.height=o,this._physijs.mass="undefined"==typeof i?s*o*n:i},y.CapsuleMesh.prototype=new y.Mesh,y.CapsuleMesh.prototype.constructor=y.CapsuleMesh,y.ConeMesh=function(t,e,i){var s,o;y.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=t.boundingBox.max.x-t.boundingBox.min.x,o=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="cone",this._physijs.radius=s/2,this._physijs.height=o,this._physijs.mass="undefined"==typeof i?s*o:i},y.ConeMesh.prototype=new y.Mesh,y.ConeMesh.prototype.constructor=y.ConeMesh,y.ConcaveMesh=function(e,i,s){var o,n,r,h,a,p,c=[];for(y.Mesh.call(this,e,i,s),e.boundingBox||e.computeBoundingBox(),a=e.vertices,o=0;o<e.faces.length;o++)p=e.faces[o],p instanceof t.Face3?c.push([{x:a[p.a].x,y:a[p.a].y,z:a[p.a].z},{x:a[p.b].x,y:a[p.b].y,z:a[p.b].z},{x:a[p.c].x,y:a[p.c].y,z:a[p.c].z}]):p instanceof t.Face4&&(c.push([{x:a[p.a].x,y:a[p.a].y,z:a[p.a].z},{x:a[p.b].x,y:a[p.b].y,z:a[p.b].z},{x:a[p.d].x,y:a[p.d].y,z:a[p.d].z}]),c.push([{x:a[p.b].x,y:a[p.b].y,z:a[p.b].z},{x:a[p.c].x,y:a[p.c].y,z:a[p.c].z},{x:a[p.d].x,y:a[p.d].y,z:a[p.d].z}]));n=e.boundingBox.max.x-e.boundingBox.min.x,r=e.boundingBox.max.y-e.boundingBox.min.y,h=e.boundingBox.max.z-e.boundingBox.min.z,this._physijs.type="concave",this._physijs.triangles=c,this._physijs.mass="undefined"==typeof s?n*r*h:s},y.ConcaveMesh.prototype=new y.Mesh,y.ConcaveMesh.prototype.constructor=y.ConcaveMesh,y.ConvexMesh=function(t,e,i){var s,o,n,r,h=[];for(y.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),s=0;s<t.vertices.length;s++)h.push({x:t.vertices[s].x,y:t.vertices[s].y,z:t.vertices[s].z});o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,r=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="convex",this._physijs.points=h,this._physijs.mass="undefined"==typeof i?o*n*r:i},y.ConvexMesh.prototype=new y.Mesh,y.ConvexMesh.prototype.constructor=y.ConvexMesh,y.Vehicle=function(t,e){e=e||new y.VehicleTuning,this.mesh=t,this.wheels=[],this._physijs={id:o(),rigidBody:t._physijs.id,suspension_stiffness:e.suspension_stiffness,suspension_compression:e.suspension_compression,suspension_damping:e.suspension_damping,max_suspension_travel:e.max_suspension_travel,friction_slip:e.friction_slip,max_suspension_force:e.max_suspension_force}},y.Vehicle.prototype.addWheel=function(e,i,s,o,n,r,h,a,p){var c=new t.Mesh(e,i);c.castShadow=c.receiveShadow=!0,c.position.copy(o).multiplyScalar(r/100).add(s),this.world.add(c),this.wheels.push(c),this.world.execute("addWheel",{id:this._physijs.id,connection_point:{x:s.x,y:s.y,z:s.z},wheel_direction:{x:o.x,y:o.y,z:o.z},wheel_axle:{x:n.x,y:n.y,z:n.z},suspension_rest_length:r,wheel_radius:h,is_front_wheel:a,tuning:p})},y.Vehicle.prototype.setSteering=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setSteering",{id:this._physijs.id,wheel:e,steering:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setSteering",{id:this._physijs.id,wheel:i,steering:t})},y.Vehicle.prototype.setBrake=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setBrake",{id:this._physijs.id,wheel:e,brake:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setBrake",{id:this._physijs.id,wheel:i,brake:t})},y.Vehicle.prototype.applyEngineForce=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:e,force:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:i,force:t})},y.VehicleTuning=function(t,e,i,s,o,n){this.suspension_stiffness=void 0!==t?t:5.88,this.suspension_compression=void 0!==e?e:.83,this.suspension_damping=void 0!==i?i:.88,this.max_suspension_travel=void 0!==s?s:500,this.friction_slip=void 0!==o?o:10.5,this.max_suspension_force=void 0!==n?n:6e3},y}},function(t,e,i){t.exports=function(){return new Worker(i.p+"9a90090c72e11ec4e983.worker.js")}}]);